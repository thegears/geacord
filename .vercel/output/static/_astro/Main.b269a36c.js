import{P as c,j as e,i as P,g as F}from"./user.a01d3f51.js";import{P as p,u as v,L as q,t as O}from"./i18n.74572b81.js";import{r as o,R as y}from"./index.6460afdd.js";import{U as V}from"./Alert.9371b4f1.js";function E(){return E=Object.assign||function(t){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&(t[l]=s[l])}return t},E.apply(this,arguments)}function z(t,a){if(t==null)return{};var s=R(t,a),l,n;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(n=0;n<r.length;n++)l=r[n],!(a.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(t,l)&&(s[l]=t[l])}return s}function R(t,a){if(t==null)return{};var s={},l=Object.keys(t),n,r;for(r=0;r<l.length;r++)n=l[r],!(a.indexOf(n)>=0)&&(s[n]=t[n]);return s}var L=o.forwardRef(function(t,a){var s=t.color,l=s===void 0?"currentColor":s,n=t.size,r=n===void 0?24:n,i=z(t,["color","size"]);return y.createElement("svg",E({ref:a,xmlns:"http://www.w3.org/2000/svg",width:r,height:r,viewBox:"0 0 24 24",fill:"none",stroke:l,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},i),y.createElement("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),y.createElement("line",{x1:"5",y1:"12",x2:"19",y2:"12"}))});L.propTypes={color:p.string,size:p.oneOfType([p.string,p.number])};L.displayName="Plus";const B=L;function I(){return I=Object.assign||function(t){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&(t[l]=s[l])}return t},I.apply(this,arguments)}function D(t,a){if(t==null)return{};var s=W(t,a),l,n;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(n=0;n<r.length;n++)l=r[n],!(a.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(t,l)&&(s[l]=t[l])}return s}function W(t,a){if(t==null)return{};var s={},l=Object.keys(t),n,r;for(r=0;r<l.length;r++)n=l[r],!(a.indexOf(n)>=0)&&(s[n]=t[n]);return s}var A=o.forwardRef(function(t,a){var s=t.color,l=s===void 0?"currentColor":s,n=t.size,r=n===void 0?24:n,i=D(t,["color","size"]);return y.createElement("svg",I({ref:a,xmlns:"http://www.w3.org/2000/svg",width:r,height:r,viewBox:"0 0 24 24",fill:"none",stroke:l,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},i),y.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),y.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))});A.propTypes={color:p.string,size:p.oneOfType([p.string,p.number])};A.displayName="X";const T=A;async function _(t){t.append("owner",c.authStore.model.id),t.append("members",[c.authStore.model.id]);try{var a=await c.collection("servers").create(t);return await c.collection("users").update(c.authStore.model.id,{"servers+":[a.id]}),a=await c.collection("servers").getOne(a.id,{expand:"members,channels"}),{res:200,server:a}}catch(s){return s}}async function U(t){try{var a=await c.collection("servers").getOne(t);return await c.collection("users").update(c.authStore.model.id,{"servers+":[a.id]}),await c.collection("servers").update(t,{"members+":[c.authStore.model.id]}),a=await c.collection("servers").getOne(a.id,{expand:"members,channels"}),{res:200,server:a}}catch(s){return s}}async function X(t){await c.collection("servers").delete(t)}async function H(t){await c.collection("users").update(c.authStore.model.id,{"servers-":[t]}),await c.collection("servers").update(t,{"members-":[c.authStore.model.id]})}async function J(t,a){try{const s=await c.collection("channels").create({server:t,name:a});return await c.collection("servers").update(t,{"channels+":[s.id]}),{res:200,channel:s}}catch(s){return s}}async function K(t,a){const s=await c.collection("messages").create({content:t,author:c.authStore.model.id,channel:a});await c.collection("channels").update(a,{"messages+":[s.id]})}function Q({set$Servers:t,$Servers:a}){const[s,l]=o.useState("add"),[n,r]=o.useState(""),[i,m]=o.useState(!1),{t:u}=v();async function f(g){g.preventDefault();const x=new FormData,b=document.getElementById("avatar").files[0],S=g.target[1].value;x.append("name",S),x.append("avatar",b),m(!0);const N=await _(x);m(!1),N?.res!=200?N.data?.data?.avatar&&(r("avatar"),setTimeout(()=>{r("")},3e3)):(t([...a,N.server]),document.getElementById("addServerModal").close())}async function j(g){g.preventDefault();const x=g.target[0].value;m(!0);const b=await U(x);m(!1),b?.res!=200?(r("server"),setTimeout(()=>{r("")},3e3)):(t([...a,b.server]),document.getElementById("addServerModal").close())}return e.jsxs(e.Fragment,{children:[n!=""&&e.jsx(V,{error:n}),e.jsx("dialog",{id:"addServerModal",className:"modal",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("div",{className:"w-full flex justify-end",children:e.jsx("button",{onClick:()=>document.getElementById("addServerModal").close(),children:e.jsx(T,{})})}),e.jsx("div",{className:"w-full h-5/6",children:s=="add"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-2xl w-full flex justify-center",children:u("chat.add-server.create-server")}),e.jsxs("form",{onSubmit:f,className:"card-body",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:u("login-register.avatar")})}),e.jsx("input",{id:"avatar",type:"file",className:"text-base-content",required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:u("chat.add-server.name")})}),e.jsx("input",{name:"username",autoComplete:"true",minLength:3,type:"text",className:"input input-bordered text-base-content",required:!0})]}),e.jsx("div",{className:"form-control mt-6",children:e.jsxs("button",{className:`btn ${i&&"btn-disabled"} btn-primary`,children:[" ",i&&e.jsx("span",{className:"loading"})," ",u("chat.add-server.create")]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-2xl w-full flex justify-center",children:u("chat.add-server.join-server")}),e.jsxs("form",{onSubmit:j,className:"card-body",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:u("chat.add-server.code")})}),e.jsx("input",{name:"username",autoComplete:"true",minLength:3,type:"text",className:"input input-bordered text-base-content",required:!0})]}),e.jsx("div",{className:"form-control mt-6",children:e.jsxs("button",{className:`btn ${i&&"btn-disabled"} btn-primary`,children:[" ",i&&e.jsx("span",{className:"loading"})," ",u("chat.add-server.join")]})})]})]})}),e.jsxs("div",{className:"w-full flex ",children:[e.jsx("button",{onClick:()=>l("add"),className:"btn w-1/2 rounded-none",children:e.jsx(B,{})}),e.jsx("button",{onClick:()=>l("join"),className:"btn w-1/2 rounded-none",children:e.jsx(q,{})})]})]})})]})}function G({setActiveTab:t,setActiveServer:a,$Servers:s,$User:l,set$Servers:n}){const{t:r}=v();return e.jsxs(e.Fragment,{children:[e.jsx(Q,{$Servers:s,set$Servers:n}),e.jsxs("ul",{className:"menu bg-base-100 w-auto h-full flex align-center items-center  ",children:[e.jsx("li",{children:e.jsx("a",{onClick:()=>t("account"),className:"tooltip w-12 tooltip-right p-0 rounded-full","data-tip":r("chat.account.account"),children:e.jsx("div",{className:"avatar",children:e.jsx("div",{className:" rounded-full hover:ring ring-base-100 ring-offset-base-100 ring-offset-2",children:e.jsx("img",{className:"rounded-full",src:`http://geacord.pockethost.io/api/files/users/${l?.id}/${l?.avatar}`})})})})}),e.jsx("div",{className:"divider"}),s.map((i,m)=>e.jsx("div",{children:e.jsx("li",{children:e.jsx("a",{onClick:()=>{t("server"),a(i)},className:"tooltip tooltip-right w-12 p-0 rounded-full mb-2","data-tip":i?.name,children:e.jsx("div",{className:"avatar",children:e.jsx("div",{className:" rounded-full hover:ring ring-base-100 ring-offset-base-100 ring-offset-2",children:e.jsx("img",{className:"rounded-full ",src:`http://geacord.pockethost.io/api/files/servers/${i?.id}/${i?.avatar}`})})})})})},m)),e.jsx("li",{children:e.jsx("a",{onClick:()=>document.getElementById("addServerModal").showModal(),className:"tooltip tooltip-right p-0 rounded-full mt-2","data-tip":r("chat.add-server.add-server"),children:e.jsx("div",{className:"avatar",children:e.jsx("div",{className:" rounded-full hover:ring ring-base-100 ring-offset-base-100 ring-offset-2",children:e.jsx(B,{})})})})})]})]})}function Y(){const{i18n:t,t:a}=v();o.useEffect(()=>{O.themeChange(!1),(localStorage.getItem("language")||"en")=="tr"&&t.changeLanguage("tr")},[]);function s(i){(localStorage.getItem("disableBg")||"false")=="false"&&(document.getElementById("mid").style.backgroundImage=`url('/${i}-bg.svg')`)}function l(){localStorage.setItem("disableBg","false");const i=localStorage.getItem("theme")||"dark";document.getElementById("mid").style.backgroundImage=`url('/${i}-bg.svg')`}function n(){localStorage.setItem("disableBg","true"),document.getElementById("mid").style.backgroundImage=""}function r(i){t.changeLanguage(i),localStorage.setItem("language",i)}return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"h-full text-neutral-content w-full bg-base-100 bg-opacity-20 p-5 overflow-auto",children:[e.jsx("p",{className:"font-bold",children:a("chat.account.change-theme")}),e.jsx("p",{children:a("chat.account.change-theme-desc")}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 lg:grid-cols-9 xl:grid-cols-11 2xl:grid-cols-11 mt-5 mb-5 gap-4",children:[e.jsx("button",{"data-theme":"light",className:"btn",onClick:()=>s("light"),"data-set-theme":"light","data-act-class":"ACTIVECLASS",children:e.jsx("a",{children:a("home.navbar.theme.light")})}),e.jsx("button",{"data-theme":"dark",className:"btn",onClick:()=>s("dark"),"data-set-theme":"dark","data-act-class":"ACTIVECLASS",children:e.jsx("a",{children:a("home.navbar.theme.dark")})}),e.jsx("button",{"data-theme":"black",className:"btn",onClick:()=>s("black"),"data-set-theme":"black","data-act-class":"ACTIVECLASS",children:e.jsx("a",{children:"Black"})}),e.jsx("button",{"data-theme":"synthwave",className:"btn",onClick:()=>s("synthwave"),"data-set-theme":"synthwave","data-act-class":"ACTIVECLASS",children:e.jsx("a",{children:"Synthwave"})}),e.jsx("button",{"data-theme":"cyberpunk",className:"btn",onClick:()=>s("cyberpunk"),"data-set-theme":"cyberpunk","data-act-class":"ACTIVECLASS",children:e.jsx("a",{children:"Cyberpunk"})}),e.jsx("button",{"data-theme":"night",className:"btn",onClick:()=>s("night"),"data-set-theme":"night","data-act-class":"ACTIVECLASS",children:e.jsx("a",{children:"Night"})}),e.jsx("button",{"data-theme":"coffee",className:"btn",onClick:()=>s("coffee"),"data-set-theme":"coffee","data-act-class":"ACTIVECLASS",children:e.jsx("a",{children:"Coffee"})}),e.jsx("button",{"data-theme":"aqua",className:"btn",onClick:()=>s("aqua"),"data-set-theme":"aqua","data-act-class":"ACTIVECLASS",children:e.jsx("a",{children:"Aqua"})}),e.jsx("button",{"data-theme":"valentine",className:"btn",onClick:()=>s("valentine"),"data-set-theme":"valentine","data-act-class":"ACTIVECLASS",children:e.jsx("a",{children:"Valentine"})}),e.jsx("button",{"data-theme":"retro",className:"btn",onClick:()=>s("retro"),"data-set-theme":"retro","data-act-class":"ACTIVECLASS",children:e.jsx("a",{children:"Retro"})}),e.jsx("button",{"data-theme":"blood",className:"btn",onClick:()=>s("blood"),"data-set-theme":"blood","data-act-class":"ACTIVECLASS",children:e.jsx("a",{children:"Blood"})})]}),e.jsx("p",{className:"font-bold",children:a("chat.account.disable-bg")}),e.jsx("p",{children:a("chat.account.disable-bg-desc")}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 lg:grid-cols-9 xl:grid-cols-11 2xl:grid-cols-11 mt-5 mb-5 gap-4",children:[e.jsx("button",{onClick:l,className:"btn btn-accent",children:e.jsx("a",{children:"Enable"})}),e.jsx("button",{onClick:n,className:"btn btn-error",children:e.jsx("a",{children:"Disable"})})]}),e.jsx("p",{className:"font-bold",children:a("chat.account.change-language")}),e.jsx("p",{children:a("chat.account.change-language-desc")}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 lg:grid-cols-9 xl:grid-cols-11 2xl:grid-cols-11 mt-5 gap-4",children:[e.jsx("button",{onClick:()=>r("tr"),className:"btn",children:e.jsx("a",{children:a("chat.account.turkish")})}),e.jsx("button",{onClick:()=>r("en"),className:"btn",children:e.jsx("a",{children:a("chat.account.english")})})]})]})})}function Z({activeServer:t,setChannels:a,channels:s}){const[l,n]=o.useState(!1),{t:r}=v();async function i(m){m.preventDefault();const u=m.target[0].value;n(!0);const f=await J(t.id,u);n(!1),a([...s,f.channel]),f?.res!=200||document.getElementById("createChannelModal").close()}return e.jsx(e.Fragment,{children:e.jsx("dialog",{id:"createChannelModal",className:"modal",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("div",{className:"w-full flex justify-end",children:e.jsx("button",{onClick:()=>document.getElementById("createChannelModal").close(),children:e.jsx(T,{})})}),e.jsxs("div",{className:"w-full h-5/6",children:[e.jsx("span",{className:"text-2xl w-full flex justify-center",children:r("chat.create-channel.create-channel")}),e.jsxs("form",{onSubmit:i,className:"card-body",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:r("chat.add-server.name")})}),e.jsx("input",{name:"username",autoComplete:"true",minLength:3,type:"text",className:"input input-bordered text-base-content",required:!0})]}),e.jsx("div",{className:"form-control mt-6",children:e.jsxs("button",{className:`btn ${l&&"btn-disabled"} btn-primary`,children:[" ",l&&e.jsx("span",{className:"loading"})," ",r("chat.add-server.create")]})})]})]})]})})})}function ee({messages:t,activeChannel:a}){const{t:s}=v();function l(){const n=document.getElementById("sendMessageInput").value;n&&(K(n,a.id),document.getElementById("sendMessageInput").value="")}return o.useEffect(()=>{const n=document.getElementById("messages");n.scrollTop=n.scrollHeight},[t]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"w-full h-full bg-base-100 p-3 flex flex-col",children:[e.jsx("div",{id:"messages",className:"h-full overflow-auto p-1 mb-2",children:t.map((n,r)=>e.jsx("div",{children:e.jsxs("div",{className:"chat chat-start",children:[e.jsx("div",{className:"chat-header",children:n.expand?.author.username}),e.jsx("div",{className:"chat-image avatar",children:e.jsx("div",{className:"w-10 rounded-full",children:e.jsx("img",{src:`http://geacord.pockethost.io/api/files/users/${n.expand.author?.id}/${n.expand.author?.avatar}`})})}),e.jsx("div",{className:"chat-bubble",children:n.content})]})},r))}),e.jsx("div",{className:"h-16 w-full",children:e.jsx("input",{id:"sendMessageInput",onKeyDown:n=>{n.key=="Enter"&&l()},type:"text",placeholder:s("chat.channel-tab.write"),className:"input input-ghost w-full "})})]})})}function te({activeServer:t,$User:a,setActiveTab:s,set$Servers:l,$Servers:n}){const{t:r}=v(),[i,m]=o.useState(!1),[u,f]=o.useState([]),[j,g]=o.useState(),[x,b]=o.useState([]),[S,N]=o.useState([]);function M(){X(t.id);var d=n;d=d.filter(h=>h.id!=t.id),l(d),s("")}function $(){H(t.id);var d=n;d=d.filter(h=>h.id!=t.id),l(d),s("")}return o.useEffect(()=>{async function d(){const h=await c.collection("channels").getOne(j.id,{expand:"messages.author"});b(h.expand.messages||[])}j?.id&&(d(),c.collection("messages").unsubscribe(),c.collection("messages").subscribe("*",async function(h){if(h.action=="create"&&j.id==h.record.channel){const C=await c.collection("messages").getOne(h.record.id,{expand:"author,channel"});b(w=>[...w,C])}}))},[j]),o.useEffect(()=>{const d=t.expand.members||[],h=t.expand.channels||[];N(d),f(h),c.collection("servers").unsubscribe(),c.collection("servers").subscribe(t.id,async function(C){if(C.action=="update"){const k=await c.collection("servers").getOne(t.id,{expand:"members,channels"});f(k.expand.channels||[]),N(k.expand.members||[])}if(C.action=="delete"){var w=n;w=w.filter(k=>k.id!=t.id),l(w),s("")}})},[t]),e.jsxs(e.Fragment,{children:[i&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"toast toast-end opacity-100",children:e.jsx("div",{className:"alert alert-success opacity-100",children:e.jsx("span",{children:r("chat.server-tab.copied")})})})}),e.jsxs("div",{className:"h-full text-neutral-content w-full flex  bg-opacity-20 overflow-auto",children:[e.jsxs("div",{className:"h-full bg-base-200 opacity-80 p-3 w-auto flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(t.id),m(!0),setTimeout(()=>{m(!1)},5e3)},className:"btn btn-wide btn-info btn-sm",children:r("chat.server-tab.invite-users")}),e.jsx("div",{className:"divider"})]}),e.jsx(Z,{channels:u,setChannels:f,activeServer:t}),e.jsxs("div",{className:"flex flex-col justify-start overflow-auto",children:[u.map((d,h)=>e.jsx("div",{children:e.jsx("button",{onClick:()=>{g(d)},className:"btn btn-wide btn-xs",children:d.name})},h)),t?.owner==a?.id&&e.jsx(e.Fragment,{children:e.jsx("button",{onClick:()=>document.getElementById("createChannelModal").showModal(),className:"btn btn-wide btn-accent btn-xs",children:r("chat.server-tab.create-channel")})})]}),t?.owner==a?.id?e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx("div",{className:"divider"}),e.jsx("button",{onClick:()=>M(),className:"btn btn-wide btn-error btn-sm mt-2",children:r("chat.server-tab.delete-server")})]})}):e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx("div",{className:"divider"}),e.jsx("button",{onClick:()=>$(),className:"btn btn-wide btn-error btn-sm mt-2",children:r("chat.server-tab.quit-server")})]})})]}),e.jsx("div",{className:"h-full bg-base-300 opacity-80 w-full flex flex-col justify-between",children:e.jsx(ee,{activeChannel:j,messages:x})}),e.jsx("div",{className:"h-full bg-base-200 opacity-80 p-5 w-64 flex flex-col overflow-auto",children:S.map((d,h)=>e.jsxs("div",{className:"p-3  w-full hover:bg-primary mb-3 ",children:[e.jsx("div",{className:"avatar flex justify-center",children:e.jsx("div",{className:"w-8 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2 ",children:e.jsx("img",{src:`http://geacord.pockethost.io/api/files/users/${d?.id}/${d?.avatar}`})})}),e.jsx("p",{className:"font-bold cursor-default flex justify-center",children:d?.username})]},h))})]})]})}function re(){const[t,a]=o.useState(""),[s,l]=o.useState(!0),[n,r]=o.useState(),[i,m]=o.useState(),[u,f]=o.useState([]);o.useEffect(()=>{async function g(){const x=await F();m(x);const b=x.expand?.servers||[];f(b),l(!1)}g()},[]);const{i18n:j}=v();return o.useEffect(()=>{O.themeChange(!1),(localStorage.getItem("language")||"en")=="tr"&&j.changeLanguage("tr")},[]),o.useEffect(()=>{c.collection("servers").subscribe("*",async function(g){if(g.action=="delete"){var x=u;x=x.filter(b=>b.id!=g.record.id),f(x),a("")}else g.action=="update"})},[]),o.useEffect(()=>{P()||(window.location.href="/")},[]),e.jsxs(e.Fragment,{children:[s&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"h-screen w-screen z-10 bg-base-100 absolute flex justify-center items-center",children:e.jsx("span",{className:"loading"})})}),e.jsx("div",{id:"mid",className:" hero min-h-screen  bg-cover",style:{backgroundImage:`url(/${localStorage.getItem("theme")||"dark"}-bg.svg)`},children:e.jsx("div",{className:"hero-overlay bg-opacity-70"})}),e.jsxs("div",{className:"absolute flex w-screen h-screen top-0 left-0",children:[e.jsx("div",{className:"h-full",children:e.jsx(G,{set$Servers:f,$Servers:u,$User:i,setActiveServer:r,setActiveTab:a})}),e.jsxs("div",{className:"h-full w-full",children:[t=="account"&&e.jsx(e.Fragment,{children:e.jsx(Y,{})}),t=="server"&&e.jsx(e.Fragment,{children:e.jsx(te,{$User:i,set$Servers:f,setActiveTab:a,$Servers:u,activeServer:n})})]})]})]})}export{re as default};
