import{P as c,j as e,i as $,g as P}from"./user.a01d3f51.js";import{P as j,u as v,L as F,t as O}from"./i18n.aa72860f.js";import{r as o,R as p}from"./index.6460afdd.js";import{U as q}from"./Alert.7865b1e8.js";function E(){return E=Object.assign||function(t){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},E.apply(this,arguments)}function V(t,a){if(t==null)return{};var s=z(t,a),n,l;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(l=0;l<r.length;l++)n=r[l],!(a.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function z(t,a){if(t==null)return{};var s={},n=Object.keys(t),l,r;for(r=0;r<n.length;r++)l=n[r],!(a.indexOf(l)>=0)&&(s[l]=t[l]);return s}var L=o.forwardRef(function(t,a){var s=t.color,n=s===void 0?"currentColor":s,l=t.size,r=l===void 0?24:l,i=V(t,["color","size"]);return p.createElement("svg",E({ref:a,xmlns:"http://www.w3.org/2000/svg",width:r,height:r,viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},i),p.createElement("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),p.createElement("line",{x1:"5",y1:"12",x2:"19",y2:"12"}))});L.propTypes={color:j.string,size:j.oneOfType([j.string,j.number])};L.displayName="Plus";const B=L;function I(){return I=Object.assign||function(t){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},I.apply(this,arguments)}function R(t,a){if(t==null)return{};var s=D(t,a),n,l;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(l=0;l<r.length;l++)n=r[l],!(a.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function D(t,a){if(t==null)return{};var s={},n=Object.keys(t),l,r;for(r=0;r<n.length;r++)l=n[r],!(a.indexOf(l)>=0)&&(s[l]=t[l]);return s}var A=o.forwardRef(function(t,a){var s=t.color,n=s===void 0?"currentColor":s,l=t.size,r=l===void 0?24:l,i=R(t,["color","size"]);return p.createElement("svg",I({ref:a,xmlns:"http://www.w3.org/2000/svg",width:r,height:r,viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},i),p.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),p.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))});A.propTypes={color:j.string,size:j.oneOfType([j.string,j.number])};A.displayName="X";const T=A;async function W(t){t.append("owner",c.authStore.model.id),t.append("members",[c.authStore.model.id]);try{var a=await c.collection("servers").create(t);return await c.collection("users").update(c.authStore.model.id,{"servers+":[a.id]}),a=await c.collection("servers").getOne(a.id,{expand:"members,channels"}),{res:200,server:a}}catch(s){return s}}async function _(t){try{var a=await c.collection("servers").getOne(t);return await c.collection("users").update(c.authStore.model.id,{"servers+":[a.id]}),await c.collection("servers").update(t,{"members+":[c.authStore.model.id]}),a=await c.collection("servers").getOne(a.id,{expand:"members,channels"}),{res:200,server:a}}catch(s){return s}}async function U(t){await c.collection("servers").delete(t)}async function X(t){await c.collection("users").update(c.authStore.model.id,{"servers-":[t]}),await c.collection("servers").update(t,{"members-":[c.authStore.model.id]})}async function Q(t,a){try{const s=await c.collection("channels").create({server:t,name:a});return await c.collection("servers").update(t,{"channels+":[s.id]}),{res:200,channel:s}}catch(s){return s}}async function H(t,a){const s=await c.collection("messages").create({content:t,author:c.authStore.model.id,channel:a});await c.collection("channels").update(a,{"messages+":[s.id]})}function J({set$Servers:t,$Servers:a}){const[s,n]=o.useState("add"),[l,r]=o.useState(""),[i,m]=o.useState(!1),{t:u}=v();async function h(f){f.preventDefault();const g=new FormData,b=document.getElementById("avatar").files[0],C=f.target[1].value;g.append("name",C),g.append("avatar",b),m(!0);const y=await W(g);m(!1),y?.res!=200?y.data?.data?.avatar&&(r("avatar"),setTimeout(()=>{r("")},3e3)):(t([...a,y.server]),document.getElementById("addServerModal").close())}async function N(f){f.preventDefault();const g=f.target[0].value;m(!0);const b=await _(g);m(!1),b?.res!=200?(r("server"),setTimeout(()=>{r("")},3e3)):(t([...a,b.server]),document.getElementById("addServerModal").close())}return e.jsxs(e.Fragment,{children:[l!=""&&e.jsx(q,{error:l}),e.jsx("dialog",{id:"addServerModal",className:"modal",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("div",{className:"w-full flex justify-end",children:e.jsx("button",{onClick:()=>document.getElementById("addServerModal").close(),children:e.jsx(T,{})})}),e.jsx("div",{className:"w-full h-5/6",children:s=="add"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-2xl w-full flex justify-center",children:u("chat.add-server.create-server")}),e.jsxs("form",{onSubmit:h,className:"card-body",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:u("login-register.avatar")})}),e.jsx("input",{id:"avatar",type:"file",className:"text-base-content",required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:u("chat.add-server.name")})}),e.jsx("input",{name:"username",autoComplete:"true",minLength:3,type:"text",className:"input input-bordered text-base-content",required:!0})]}),e.jsx("div",{className:"form-control mt-6",children:e.jsxs("button",{className:`btn ${i&&"btn-disabled"} btn-primary`,children:[" ",i&&e.jsx("span",{className:"loading"})," ",u("chat.add-server.create")]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-2xl w-full flex justify-center",children:u("chat.add-server.join-server")}),e.jsxs("form",{onSubmit:N,className:"card-body",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:u("chat.add-server.code")})}),e.jsx("input",{name:"username",autoComplete:"true",minLength:3,type:"text",className:"input input-bordered text-base-content",required:!0})]}),e.jsx("div",{className:"form-control mt-6",children:e.jsxs("button",{className:`btn ${i&&"btn-disabled"} btn-primary`,children:[" ",i&&e.jsx("span",{className:"loading"})," ",u("chat.add-server.join")]})})]})]})}),e.jsxs("div",{className:"w-full flex ",children:[e.jsx("button",{onClick:()=>n("add"),className:"btn w-1/2 rounded-none",children:e.jsx(B,{})}),e.jsx("button",{onClick:()=>n("join"),className:"btn w-1/2 rounded-none",children:e.jsx(F,{})})]})]})})]})}function K({setActiveTab:t,setActiveServer:a,$Servers:s,$User:n,set$Servers:l}){const{t:r}=v();return e.jsxs(e.Fragment,{children:[e.jsx(J,{$Servers:s,set$Servers:l}),e.jsxs("ul",{className:"menu bg-base-100 w-auto h-full flex align-center items-center  ",children:[e.jsx("li",{children:e.jsx("a",{onClick:()=>t("account"),className:"tooltip w-12 tooltip-right p-0 rounded-full","data-tip":r("chat.account.account"),children:e.jsx("div",{className:"avatar",children:e.jsx("div",{className:" rounded-full hover:ring ring-base-100 ring-offset-base-100 ring-offset-2",children:e.jsx("img",{className:"rounded-full",src:`http://geacord.pockethost.io/api/files/users/${n?.id}/${n?.avatar}`})})})})}),e.jsx("div",{className:"divider"}),s.map((i,m)=>e.jsx("div",{children:e.jsx("li",{children:e.jsx("a",{onClick:()=>{t("server"),a(i)},className:"tooltip tooltip-right w-12 p-0 rounded-full mb-2","data-tip":i?.name,children:e.jsx("div",{className:"avatar",children:e.jsx("div",{className:" rounded-full hover:ring ring-base-100 ring-offset-base-100 ring-offset-2",children:e.jsx("img",{className:"rounded-full ",src:`http://geacord.pockethost.io/api/files/servers/${i?.id}/${i?.avatar}`})})})})})},m)),e.jsx("li",{children:e.jsx("a",{onClick:()=>document.getElementById("addServerModal").showModal(),className:"tooltip tooltip-right p-0 rounded-full mt-2","data-tip":r("chat.add-server.add-server"),children:e.jsx("div",{className:"avatar",children:e.jsx("div",{className:" rounded-full hover:ring ring-base-100 ring-offset-base-100 ring-offset-2",children:e.jsx(B,{})})})})})]})]})}function G(){const{i18n:t,t:a}=v();o.useEffect(()=>{O.themeChange(!1),(localStorage.getItem("language")||"en")=="tr"&&t.changeLanguage("tr")},[]);function s(i){(localStorage.getItem("disableBg")||"false")=="false"&&(document.getElementById("mid").style.backgroundImage=`url('/${i}-bg.svg')`)}function n(){localStorage.setItem("disableBg","false");const i=localStorage.getItem("theme")||"dark";document.getElementById("mid").style.backgroundImage=`url('/${i}-bg.svg')`}function l(){localStorage.setItem("disableBg","true"),document.getElementById("mid").style.backgroundImage=""}function r(i){t.changeLanguage(i),localStorage.setItem("language",i)}return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"h-full text-neutral-content w-full bg-base-100 bg-opacity-20 p-5 overflow-auto",children:[e.jsx("p",{className:"font-bold",children:a("chat.account.change-theme")}),e.jsx("p",{children:a("chat.account.change-theme-desc")}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 lg:grid-cols-9 xl:grid-cols-11 2xl:grid-cols-11 mt-5 mb-5 gap-4",children:[e.jsx("button",{"data-theme":"light",className:"btn",onClick:()=>s("light"),"data-set-theme":"light","data-act-class":"ACTIVECLASS",children:e.jsx("a",{children:a("home.navbar.theme.light")})}),e.jsx("button",{"data-theme":"dark",className:"btn",onClick:()=>s("dark"),"data-set-theme":"dark","data-act-class":"ACTIVECLASS",children:e.jsx("a",{children:a("home.navbar.theme.dark")})}),e.jsx("button",{"data-theme":"black",className:"btn",onClick:()=>s("black"),"data-set-theme":"black","data-act-class":"ACTIVECLASS",children:e.jsx("a",{children:"Black"})}),e.jsx("button",{"data-theme":"synthwave",className:"btn",onClick:()=>s("synthwave"),"data-set-theme":"synthwave","data-act-class":"ACTIVECLASS",children:e.jsx("a",{children:"Synthwave"})}),e.jsx("button",{"data-theme":"cyberpunk",className:"btn",onClick:()=>s("cyberpunk"),"data-set-theme":"cyberpunk","data-act-class":"ACTIVECLASS",children:e.jsx("a",{children:"Cyberpunk"})}),e.jsx("button",{"data-theme":"night",className:"btn",onClick:()=>s("night"),"data-set-theme":"night","data-act-class":"ACTIVECLASS",children:e.jsx("a",{children:"Night"})}),e.jsx("button",{"data-theme":"coffee",className:"btn",onClick:()=>s("coffee"),"data-set-theme":"coffee","data-act-class":"ACTIVECLASS",children:e.jsx("a",{children:"Coffee"})}),e.jsx("button",{"data-theme":"aqua",className:"btn",onClick:()=>s("aqua"),"data-set-theme":"aqua","data-act-class":"ACTIVECLASS",children:e.jsx("a",{children:"Aqua"})}),e.jsx("button",{"data-theme":"valentine",className:"btn",onClick:()=>s("valentine"),"data-set-theme":"valentine","data-act-class":"ACTIVECLASS",children:e.jsx("a",{children:"Valentine"})}),e.jsx("button",{"data-theme":"retro",className:"btn",onClick:()=>s("retro"),"data-set-theme":"retro","data-act-class":"ACTIVECLASS",children:e.jsx("a",{children:"Retro"})}),e.jsx("button",{"data-theme":"blood",className:"btn",onClick:()=>s("blood"),"data-set-theme":"blood","data-act-class":"ACTIVECLASS",children:e.jsx("a",{children:"Blood"})})]}),e.jsx("p",{className:"font-bold",children:a("chat.account.disable-bg")}),e.jsx("p",{children:a("chat.account.disable-bg-desc")}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 lg:grid-cols-9 xl:grid-cols-11 2xl:grid-cols-11 mt-5 mb-5 gap-4",children:[e.jsx("button",{onClick:n,className:"btn btn-accent",children:e.jsx("a",{children:"Enable"})}),e.jsx("button",{onClick:l,className:"btn btn-error",children:e.jsx("a",{children:"Disable"})})]}),e.jsx("p",{className:"font-bold",children:a("chat.account.change-language")}),e.jsx("p",{children:a("chat.account.change-language-desc")}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 lg:grid-cols-9 xl:grid-cols-11 2xl:grid-cols-11 mt-5 gap-4",children:[e.jsx("button",{onClick:()=>r("tr"),className:"btn",children:e.jsx("a",{children:a("chat.account.turkish")})}),e.jsx("button",{onClick:()=>r("en"),className:"btn",children:e.jsx("a",{children:a("chat.account.english")})})]})]})})}function Y({activeServer:t,setChannels:a,channels:s}){const[n,l]=o.useState(!1),{t:r}=v();async function i(m){m.preventDefault();const u=m.target[0].value;l(!0);const h=await Q(t.id,u);l(!1),a([...s,h.channel]),h?.res!=200||document.getElementById("createChannelModal").close()}return e.jsx(e.Fragment,{children:e.jsx("dialog",{id:"createChannelModal",className:"modal",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("div",{className:"w-full flex justify-end",children:e.jsx("button",{onClick:()=>document.getElementById("createChannelModal").close(),children:e.jsx(T,{})})}),e.jsxs("div",{className:"w-full h-5/6",children:[e.jsx("span",{className:"text-2xl w-full flex justify-center",children:r("chat.create-channel.create-channel")}),e.jsxs("form",{onSubmit:i,className:"card-body",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:r("chat.add-server.name")})}),e.jsx("input",{name:"username",autoComplete:"true",minLength:3,type:"text",className:"input input-bordered text-base-content",required:!0})]}),e.jsx("div",{className:"form-control mt-6",children:e.jsxs("button",{className:`btn ${n&&"btn-disabled"} btn-primary`,children:[" ",n&&e.jsx("span",{className:"loading"})," ",r("chat.add-server.create")]})})]})]})]})})})}function Z({messages:t,activeChannel:a}){function s(){const n=document.getElementById("sendMessageInput").value;n&&(H(n,a.id),document.getElementById("sendMessageInput").value="")}return o.useEffect(()=>{const n=document.getElementById("messages");n.scrollTop=n.scrollHeight},[t]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"w-full h-full bg-base-100 p-3 flex flex-col",children:[e.jsx("div",{id:"messages",className:"h-full overflow-auto p-1 mb-2",children:t.map((n,l)=>e.jsx("div",{children:e.jsxs("div",{className:"chat chat-start",children:[e.jsx("div",{className:"chat-image avatar",children:e.jsx("div",{className:"w-10 rounded-full",children:e.jsx("img",{src:`http://geacord.pockethost.io/api/files/users/${n.expand.author?.id}/${n.expand.author?.avatar}`})})}),e.jsx("div",{className:"chat-bubble",children:n.content})]})},l))}),e.jsx("div",{className:"h-16 w-full",children:e.jsx("input",{id:"sendMessageInput",onKeyDown:n=>{n.key=="Enter"&&s()},type:"text",placeholder:"Type here",className:"input input-ghost w-full "})})]})})}function ee({activeServer:t,$User:a,setActiveTab:s,set$Servers:n,$Servers:l}){v();const[r,i]=o.useState(!1),[m,u]=o.useState([]),[h,N]=o.useState(),[f,g]=o.useState([]),[b,C]=o.useState([]);function y(){U(t.id);var d=l;d=d.filter(x=>x.id!=t.id),n(d),s("")}function M(){X(t.id);var d=l;d=d.filter(x=>x.id!=t.id),n(d),s("")}return o.useEffect(()=>{async function d(){const x=await c.collection("channels").getOne(h.id,{expand:"messages.author"});g(x.expand.messages||[])}h?.id&&(d(),c.collection("messages").unsubscribe(),c.collection("messages").subscribe("*",async function(x){if(x.action=="create"&&h.id==x.record.channel){const S=await c.collection("messages").getOne(x.record.id,{expand:"author,channel"});g(w=>[...w,S])}}))},[h]),o.useEffect(()=>{const d=t.expand.members||[],x=t.expand.channels||[];C(d),u(x),c.collection("servers").unsubscribe(),c.collection("servers").subscribe(t.id,async function(S){if(S.action=="update"){const k=await c.collection("servers").getOne(t.id,{expand:"members,channels"});u(k.expand.channels||[]),C(k.expand.members||[])}if(S.action=="delete"){var w=l;w=w.filter(k=>k.id!=t.id),n(w),s("")}})},[t]),e.jsxs(e.Fragment,{children:[r&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"toast toast-end",children:e.jsx("div",{className:"alert alert-success",children:e.jsx("span",{children:"Server's code copied."})})})}),e.jsxs("div",{className:"h-full text-neutral-content w-full flex  bg-opacity-20 overflow-auto",children:[e.jsxs("div",{className:"h-full bg-base-200 opacity-80 p-3 w-auto flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(t.id),i(!0),setTimeout(()=>{i(!1)},5e3)},className:"btn btn-wide btn-info btn-sm",children:"Invite users"}),e.jsx("div",{className:"divider"})]}),e.jsx(Y,{channels:m,setChannels:u,activeServer:t}),e.jsxs("div",{className:"flex flex-col justify-start overflow-auto",children:[m.map((d,x)=>e.jsx("div",{children:e.jsx("button",{onClick:()=>{N(d)},className:"btn btn-wide btn-xs",children:d.name})},x)),t?.owner==a?.id&&e.jsx(e.Fragment,{children:e.jsx("button",{onClick:()=>document.getElementById("createChannelModal").showModal(),className:"btn btn-wide btn-accent btn-xs",children:"Create Channel"})})]}),t?.owner==a?.id?e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx("div",{className:"divider"}),e.jsx("button",{onClick:()=>y(),className:"btn btn-wide btn-error btn-sm mt-2",children:"Delete Server"})]})}):e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx("div",{className:"divider"}),e.jsx("button",{onClick:()=>M(),className:"btn btn-wide btn-error btn-sm mt-2",children:"Quit Server"})]})})]}),e.jsx("div",{className:"h-full bg-base-300 opacity-80 w-full flex flex-col justify-between",children:e.jsx(Z,{activeChannel:h,messages:f})}),e.jsx("div",{className:"h-full bg-base-200 opacity-80 p-5 w-64 flex flex-col overflow-auto",children:b.map((d,x)=>e.jsxs("div",{className:"p-3  w-full hover:bg-primary mb-3 ",children:[e.jsx("div",{className:"avatar flex justify-center",children:e.jsx("div",{className:"w-8 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2 ",children:e.jsx("img",{src:`http://geacord.pockethost.io/api/files/users/${d?.id}/${d?.avatar}`})})}),e.jsx("p",{className:"font-bold cursor-default flex justify-center",children:d?.username})]},x))})]})]})}function le(){const[t,a]=o.useState(""),[s,n]=o.useState(!0),[l,r]=o.useState(),[i,m]=o.useState(),[u,h]=o.useState([]);o.useEffect(()=>{async function f(){const g=await P();m(g);const b=g.expand?.servers||[];h(b),n(!1)}f()},[]);const{i18n:N}=v();return o.useEffect(()=>{O.themeChange(!1),(localStorage.getItem("language")||"en")=="tr"&&N.changeLanguage("tr")},[]),o.useEffect(()=>{c.collection("servers").subscribe("*",async function(f){if(f.action=="delete"){var g=u;g=g.filter(b=>b.id!=f.record.id),h(g),a("")}else f.action=="update"})},[]),o.useEffect(()=>{$()||(window.location.href="/")},[]),e.jsxs(e.Fragment,{children:[s&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"h-screen w-screen z-10 bg-base-100 absolute flex justify-center items-center",children:e.jsx("span",{className:"loading"})})}),e.jsx("div",{id:"mid",className:" hero min-h-screen  bg-cover",style:{backgroundImage:`url(/${localStorage.getItem("theme")||"dark"}-bg.svg)`},children:e.jsx("div",{className:"hero-overlay bg-opacity-70"})}),e.jsxs("div",{className:"absolute flex w-screen h-screen top-0 left-0",children:[e.jsx("div",{className:"h-full",children:e.jsx(K,{set$Servers:h,$Servers:u,$User:i,setActiveServer:r,setActiveTab:a})}),e.jsxs("div",{className:"h-full w-full",children:[t=="account"&&e.jsx(e.Fragment,{children:e.jsx(G,{})}),t=="server"&&e.jsx(e.Fragment,{children:e.jsx(ee,{$User:i,set$Servers:h,setActiveTab:a,$Servers:u,activeServer:l})})]})]})]})}export{le as default};
